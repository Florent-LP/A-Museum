<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>Ys Museum</title>

        <script src="dist/stable/aframe.min.js"></script>
        <script src="dist/extras/aframe-extras.min.js"></script>
    </head>
    <body>
        <a-scene physics stats>
            <a-assets>
                <!-- Textures prod (lent) -->
                <img id="skybox" src="assets/images/sky-r2.jpg">
                <img id="terrasse" src="assets/images/textures/terrasse-corrected.jpg">
                <img id="parquet" src="assets/images/textures/parquet.jpg">
                <img id="mur" src="assets/images/textures/mur2-corrected.jpg">
                <img id="vitre" src="assets/images/textures/verre.png">
                <img id="pillier" src="assets/images/textures/pillier.jpg">
                <a-mixin id="pillier" material="src: #pillier; repeat: 2 3;">

                <!-- Textures dev (rapide) -->
                <!-- <img id="skybox" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOs////PwAIAAN+P+P0CgAAAABJRU5ErkJggg=="> -->
                <!-- <img id="terrasse" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPcksLwHwAFBQIZtcb7ngAAAABJRU5ErkJggg=="> -->
                <!-- <img id="parquet" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8cILhPwAHIQK5QliE3QAAAABJRU5ErkJggg=="> -->
                <!-- <img id="mur" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mM88x8AAp0BzdNtlUkAAAAASUVORK5CYII="> -->
                <!-- <img id="vitre" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOs////PwAIAAN+P+P0CgAAAABJRU5ErkJggg=="> -->
                <!-- <img id="pillier" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPcksLwHwAFBQIZtcb7ngAAAABJRU5ErkJggg=="> -->
                <!-- <a-mixin id="pillier" material="color: orange;"> -->

                <!-- Modèles -->
                <a-asset-item id="stairs-obj" src="assets/models/stairs/stairs.obj"></a-asset-item>
                <a-asset-item id="stairs-mtl" src="assets/models/stairs/stairs.mtl"></a-asset-item>
                <a-asset-item id="ladder-obj" src="assets/models/stairs/ladder.obj"></a-asset-item>
                <a-asset-item id="ladder-mtl" src="assets/models/stairs/ladder.mtl"></a-asset-item>

                <a-asset-item id="wood-table-obj" src="assets/models/tables/wood_table.obj"></a-asset-item>
                <a-asset-item id="marble-table-obj" src="assets/models/tables/marble_table.obj"></a-asset-item>
                <a-asset-item id="marble-table-mtl" src="assets/models/tables/marble_table.mtl"></a-asset-item>

                <a-asset-item id="upper-cabinet-obj" src="assets/models/upper_cabinet.obj"></a-asset-item>
                <a-asset-item id="upper-cabinet-mtl" src="assets/models/upper_cabinet.mtl"></a-asset-item>

                <a-asset-item id="bibliotheque-obj" src="assets/models/books/bibliotheque.obj"></a-asset-item>
                <a-asset-item id="smallbookshelves-obj" src="assets/models/books/smallbookshelves.obj"></a-asset-item>
                <a-asset-item id="smallbookshelves-mtl" src="assets/models/books/smallbookshelves.mtl"></a-asset-item>

                <a-asset-item id="sofa-obj" src="assets/models/sofa.obj"></a-asset-item>
                <a-asset-item id="sofa-mtl" src="assets/models/sofa.mtl"></a-asset-item>

                <a-asset-item id="penguin-obj" src="assets/models/penguin/penguin.obj"></a-asset-item>
                <a-asset-item id="penguin-mtl" src="assets/models/penguin/penguin.mtl"></a-asset-item>

                <a-asset-item id="door-obj" src="assets/models/accordionFoldDoors.obj"></a-asset-item>
                <a-asset-item id="door-mtl" src="assets/models/accordionFoldDoors.mtl"></a-asset-item>

                <a-asset-item id="speaker-obj" src="assets/models/speaker3.obj"></a-asset-item>
                <a-asset-item id="speaker-mtl" src="assets/models/speaker3.mtl"></a-asset-item>

                <!-- Tableaux -->
                <a-asset-item id="t1-obj" src="assets/models/paintings/AntelopeCanyonFrame.obj"></a-asset-item>
                <a-asset-item id="t2-obj" src="assets/models/paintings/YosemiteFrame.obj"></a-asset-item>
                <a-asset-item id="t3-obj" src="assets/models/paintings/frame_horizontal.obj"></a-asset-item>
                <a-asset-item id="t4-obj" src="assets/models/paintings/frame_vertical.obj"></a-asset-item>
                <a-asset-item id="t5-obj" src="assets/models/paintings/NiagaraFallsFrame.obj"></a-asset-item>
                <a-asset-item id="t6-obj" src="assets/models/paintings/EtretatFrame.obj"></a-asset-item>
                <a-asset-item id="t7-obj" src="assets/models/paintings/frame3HorizontalNorwayPhotos.obj"></a-asset-item>
                <a-asset-item id="t8-obj" src="assets/models/paintings/frame_square.obj"></a-asset-item>
                <a-asset-item id="t9-obj" src="assets/models/paintings/HaiVanPassFrame.obj"></a-asset-item>
                <a-asset-item id="t1-mtl" src="assets/models/paintings/AntelopeCanyonFrame.mtl"></a-asset-item>
                <a-asset-item id="t2-mtl" src="assets/models/paintings/YosemiteFrame.mtl"></a-asset-item>
                <a-asset-item id="t3-mtl" src="assets/models/paintings/frame_horizontal.mtl"></a-asset-item>
                <a-asset-item id="t4-mtl" src="assets/models/paintings/frame_vertical.mtl"></a-asset-item>
                <a-asset-item id="t5-mtl" src="assets/models/paintings/NiagaraFallsFrame.mtl"></a-asset-item>
                <a-asset-item id="t6-mtl" src="assets/models/paintings/EtretatFrame.mtl"></a-asset-item>
                <a-asset-item id="t7-mtl" src="assets/models/paintings/frame3HorizontalNorwayPhotos.mtl"></a-asset-item>
                <a-asset-item id="t8-mtl" src="assets/models/paintings/frame_square.mtl"></a-asset-item>
                <a-asset-item id="t9-mtl" src="assets/models/paintings/HaiVanPassFrame.mtl"></a-asset-item>

                <!-- Etc -->
                <!-- <video id="ys-movie" autoplay loop="true" src="videos/ys-movie-short.webm"> -->
            </a-assets>


            <a-sky src="#skybox"></a-sky>


            <!-- Soleil (avec sphere) -->
            <!--<a-sphere
                radius="50"
                shader="flat" color="orange" light="type: point"
                position="1050 1000 60"
            ></a-sphere>-->

            <!-- Soleil (sans sphère) -->
            <a-light
                color="white"
                type="directional"
                position="1.05 1 .6"
                intensity=".5"
            ></a-light>

            <!-- Lumière solaire reflétée (Bug : intensity -> Solution : color)-->
            <a-light
                color="#666"
                type="ambient"
            ></a-light>


            <a-entity position="0 -3.25 -60"> <!-- Note : J'enlève 0.002 aux largeurs pour éviter le scintillement lié à la superposition de certains plans. -->
                <!-- Note (physics) : Le joueur ne semble être bloqué par les static-body que s'ils sont dans la même entity que la camera. -->
                <a-camera kinematic-body="mass: 1" universal-controls="movementEnabled: true" jump-ability="distance: 4" position="0 5.14 10">
                        <a-sphere radius=".2" shader="flat" color="lightblue" light="type: point; intensity: .25; color: lightblue;" position="0.8 -0.5 -1.5"></a-sphere> <!--Lampe -->
                        <a-plane width=".05" height="1" rotation="0 0 90" position="0 -1 -2"></a-plane> <!-- Règle (mesure) -->

                        <a-cursor fuse="true" max-distance="30" timeout="1500">
                            <a-animation begin="cursorEvt" easing="ease-in" attribute="scale" fill="forwards" from="1.7 1.7 1.7" to="1 1 1" dur="1500"></a-animation>
                        </a-cursor>
                        <a-animation id="fwdAnim" begin="fwdEvt" easing="linear" attribute="position" fill="forwards" to="0 5.14 0" dur="2500"></a-animation>
                </a-camera>


                <!-- Mer -->
                <!-- <a-plane static-body color="#0088FF" width="1000" height="1000" rotation="-90 0 0" position="0 -2.5 0"></a-plane> -->
                <a-ocean static-body color="#92E2E2" width="50" depth="50" density="10" speed="2"></a-ocean>

                <a-plane static-body color="#000201" opacity=".8" width="250" height="50" rotation="-90 0 0" position="150 -0.5 0"></a-plane>
                <a-plane static-body color="#000201" opacity=".8" width="250" height="50" rotation="-90 0 0" position="-150 -0.5 0"></a-plane>
                <a-plane static-body color="#000201" opacity=".8" width="250" height="250" rotation="-90 0 0" position="-150 -0.5 150"></a-plane>
                <a-plane static-body color="#000201" opacity=".8" width="50" height="250" rotation="-90 0 0" position="0 -0.5 150"></a-plane>
                <a-plane static-body color="#000201" opacity=".8" width="250" height="250" rotation="-90 0 0" position="150 -0.5 150"></a-plane>
                <a-plane static-body color="#000201" opacity=".8" width="250" height="250" rotation="-90 0 0" position="-150 -0.5 -150"></a-plane>
                <a-plane static-body color="#000201" opacity=".8" width="50" height="250" rotation="-90 0 0" position="0 -0.5 -150"></a-plane>
                <a-plane static-body color="#000201" opacity=".8" width="250" height="250" rotation="-90 0 0" position="150 -0.5 -150"></a-plane>

                <a-plane static-body color="#7FFFFF" width="800" height="800" rotation="-90 0 0" position="0 -4 0"></a-plane>


                <!-- Plateforme / DÉBUT -->
                <!-- Piliers -->
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="14 0 14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="4.75 0 14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="14 0 4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="4.75 0 4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-14 0 14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-4.75 0 14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-14 0 4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-4.75 0 4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="14 0 -14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="4.75 0 -14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="14 0 -4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="4.75 0 -4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-14 0 -14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-4.75 0 -14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-14 0 -4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-4.75 0 -4.75"></a-cylinder>

                <!-- Sol -->
                <a-box static-body src="#terrasse" repeat="10 10" depth=".5" width="30" height="30" rotation="-90 0 0" position="0 3 0"></a-box>
                <a-plane static-body src="#parquet" repeat="6 4" width="30" height="20" rotation="-90 0 0" position="0 3.251 -5"></a-plane>

                <!-- Colliders (room detection) -->
                <a-plane id="hall" coll-trigger static-body opacity="0" width="30" height="10" rotation="-90 0 0" position="0 3.252 0"></a-plane>
                <a-plane id="Room1" coll-trigger static-body opacity="0" width="7.5" height="10" rotation="-90 0 0" position="-11.25 3.253 -10"></a-plane>
                <a-plane id="Room2" coll-trigger static-body opacity="0" width="7.5" height="10" rotation="-90 0 0" position="-3.75 3.253 -10"></a-plane>
                <a-plane id="Room3" coll-trigger static-body opacity="0" width="7.5" height="10" rotation="-90 0 0" position="3.75 3.253 -10"></a-plane>
                <a-plane id="Room4" coll-trigger static-body opacity="0" width="7.5" height="10" rotation="-90 0 0" position="11.25 3.254 -10"></a-plane>

                <!-- Échelles -->
                <a-box static-body src="#pillier" repeat="14 1" depth=".8" width="28" height="1" position="0 0 14.7"></a-box>

                <a-obj-model src="#ladder-obj" mtl="#ladder-mtl" position="9 0 15" scale=".02 .02 .02"></a-obj-model>
                <a-obj-model src="#ladder-obj" mtl="#ladder-mtl" position="0 0 15" scale=".02 .02 .02"></a-obj-model>
                <a-obj-model src="#ladder-obj" mtl="#ladder-mtl" position="-9 0 15" scale=".02 .02 .02"></a-obj-model>
                <!-- Plateforme / FIN -->


                <!-- Murs principaux / DÉBUT -->
                <!-- Nord -->
                <a-box static-body src="#mur" repeat="15 3" depth=".25" width="29.998" height="6" position="0 6.25 -14.875"></a-box>

                <!-- Est -->
                <a-box static-body src="#mur" repeat="6.25 1.5" depth=".25" width="12.498" height="3" position="14.875 4.75 -8.75" rotation="0 -90 0"></a-box>
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="14.875 4.75 3.75" rotation="0 -90 0"></a-box>
                <a-box static-body src="#vitre" repeat="5 3" opacity="0.5" color="lightblue" depth=".05" width="5" height="3"  position="14.875 4.75 0" rotation="0 -90 0"></a-box>

                <a-box static-body src="#mur" repeat="10 1.5" depth=".25" width="19.998" height="3" position="14.875 7.75 -5" rotation="0 -90 0"></a-box>

                <!-- Ouest -->
                <a-box static-body src="#mur" repeat="6.25 1.5" depth=".25" width="12.498" height="3" position="-14.875 4.75 -8.75" rotation="0 90 0"></a-box>
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="-14.875 4.75 3.75" rotation="0 90 0"></a-box>
                <a-box static-body src="#vitre" repeat="5 3" opacity="0.5" color="lightblue" depth=".05" width="5" height="3"  position="-14.875 4.75 0" rotation="0 90 0"></a-box>

                <a-box static-body src="#mur" repeat="10 1.5" depth=".25" width="19.998" height="3" position="-14.875 7.75 -5" rotation="0 90 0"></a-box>

                <!-- Sud (Terrasse) -->
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="-3.25 4.75 4.875"></a-box>
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="-13.75 4.75 4.875"></a-box>
                <a-box static-body src="#vitre" repeat="8 3" opacity="0.5" color="lightblue" depth=".05" width="8" height="3" position="-8.5 4.75 4.875"></a-box>

                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="3.25 4.75 4.875"></a-box>
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="13.75 4.75 4.875"></a-box>
                <a-box static-body src="#vitre" repeat="8 3" opacity="0.5" color="lightblue" depth=".05" width="8" height="3" position="8.5 4.75 4.875"></a-box>

                <a-box static-body src="#mur" repeat="15 1.5" depth=".25" width="29.998" height="3" position="0 7.75 4.875"></a-box>

                <!-- Entrée -->
                <!-- <a-box src="#vitre" repeat="4 3" opacity="0.5" color="lightblue" depth=".05" width="4" height="3" position="0 4.75 4.875"></a-box> -->
                <a-obj-model src="#door-obj" mtl="#door-mtl" scale=".9 .9 .9" position="-0.6 4.65 5"></a-obj-model>

                <!-- Plafond -->
                <a-box static-body src="#mur" repeat="15 12.5" depth=".25" width="29.998" height="25" position="0 9.375 -2.5" rotation="90 0 0"></a-box>
                <!-- Murs principaux / FIN -->


                <!-- Murs intérieurs / DÉBUT -->
                <!-- Mezzanine -->
                <a-box static-body src="#parquet" repeat="6 2" depth=".25" width="29.998" height="9.998" position="0 6.375 -10" rotation="90 0 0"></a-box>

                <!-- Cloisons fixes -->
                <a-box static-body src="#mur" repeat="5 1.5" depth=".25" width="9.998" height="3" position="0 4.75 -10" rotation="0 90 0"></a-box>
                <a-box static-body src="#mur" repeat="2 1.5" depth=".25" width="3.998" height="3" position="7.5 4.75 -7" rotation="0 90 0"></a-box><a-box src="#mur" repeat="2 1.5" depth=".25" width="3.998" height="3" position="7.5 4.75 -13" rotation="0 90 0"></a-box>
                <a-box static-body src="#mur" repeat="5 1.5" depth=".25" width="9.998" height="3" position="-7.5 4.75 -10" rotation="0 90 0"></a-box>

                <a-box static-body src="#mur" repeat="2.25 1.5" depth=".25" width="4.48" height="3" position="0 4.75 -5.125"></a-box>
                <a-box static-body src="#mur" repeat="2.25 1.5" depth=".25" width="4.48" height="3" position="7.5 4.75 -5.125"></a-box>
                <a-box static-body src="#mur" repeat="2.25 1.5" depth=".25" width="4.48" height="3" position="-7.5 4.75 -5.125"></a-box>
                <a-box static-body src="#mur" repeat="1.125 1.5" depth=".25" width="2.248" height="3" position="13.875 4.75 -5.125"></a-box>
                <a-box static-body src="#mur" repeat="1.125 1.5" depth=".25" width="2.248" height="3" position="-13.875 4.75 -5.125"></a-box>
                <!-- Murs intérieurs / FIN -->


                <!-- Repère -->
                <a-entity position="0 3.25 10">
                    <a-sphere color="grey" radius=".2" ></a-sphere>
                    <!-- X --><a-cylinder height="2" color="red"   radius=".05" position="1 0 0" rotation="0 0 -90"></a-cylinder>
                    <!-- Y --><a-cylinder height="2" color="green"  radius=".05" position="0 1 0"></a-cylinder>
                    <!-- Z --><a-cylinder height="2" color="blue" radius=".05" position="0 0 1" rotation="90 0 0"></a-cylinder>
                </a-entity>

                <!-- Ballon -->
                <a-sphere gaze-anim dynamic-body radius=".3" shader="flat" color="lightblue" light="type: point; intensity: .25; color: lightblue;" position="2 6 2"></a-sphere>

                <!-- Stair collider -->
                <a-plane static-body opacity="0" width="1" height="5.5" rotation="-51 0 0" position="13.6 5 -2.9"></a-plane>

                <!-- Mobilier & objets / DÉBUT -->
                <a-entity position="0 3.25 0"><!-- Hall -->

                    <!-- Escaliers -->
                    <a-obj-model src="#stairs-obj" mtl="#stairs-mtl" position="13.6 0 -3.2" scale=".012 .012 .012"></a-obj-model>

                    <!-- Tables -->
                    <a-box gaze-anim color="lightblue" opacity="0" depth="1" width="2" height="2" position="-7.5 1 -4.3"><!-- Hitbox -->
                        <a-obj-model src="#wood-table-obj" color="#630" scale=".025 .025 .025" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>
                    <a-box gaze-anim color="lightblue" opacity="0" depth="1" width="2" height="2" position="0 1 -4.3"><!-- Hitbox -->
                        <a-obj-model src="#wood-table-obj" color="#630" scale=".025 .025 .025" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>
                    <a-box gaze-anim color="lightblue" opacity="0" depth="1" width="2" height="2" position="7.5 1 -4.3"><!-- Hitbox -->
                        <a-obj-model src="#wood-table-obj" color="#630" scale=".025 .025 .025" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>

                    <a-box gaze-anim color="lightblue" opacity="0" depth="1" width="2" height="2" position="-10 1 4.2"><!-- Hitbox -->
                        <a-obj-model src="#wood-table-obj" color="#630" scale=".025 .025 .025" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>
                    <a-box gaze-anim color="lightblue" opacity="0" depth="1" width="2" height="2" position="-6 1 4.2"><!-- Hitbox -->
                        <a-obj-model src="#wood-table-obj" color="#630" scale=".025 .025 .025" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>
                    <a-box gaze-anim color="lightblue" opacity="0" depth="1" width="2" height="2" position="6 1 4.2"><!-- Hitbox -->
                        <a-obj-model src="#wood-table-obj" color="#630" scale=".025 .025 .025" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>
                    <a-box gaze-anim color="lightblue" opacity="0" depth="1" width="2" height="2" position="10 1 4.2"><!-- Hitbox -->
                        <a-obj-model src="#wood-table-obj" color="#630" scale=".025 .025 .025" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>

                    <a-box gaze-anim color="lightblue" opacity="0" depth="2" width="2" height="2" position="-13.8 1 -4"><!-- Hitbox -->
                        <a-obj-model src="#marble-table-obj" mtl="#marble-table-mtl" scale=".015 .015 .015" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>
                    <a-box gaze-anim color="lightblue" opacity="0" depth="2" width="2" height="2" position="-13.8 1 -0.1"><!-- Hitbox -->
                        <a-obj-model src="#marble-table-obj" mtl="#marble-table-mtl" scale=".015 .015 .015" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>
                    <a-box gaze-anim color="lightblue" opacity="0" depth="2" width="2" height="2" position="-13.8 1 3.8"><!-- Hitbox -->
                        <a-obj-model src="#marble-table-obj" mtl="#marble-table-mtl" scale=".015 .015 .015" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>
                    <a-box gaze-anim color="lightblue" opacity="0" depth="2" width="2" height="2" position="13.8 1 3.8"><!-- Hitbox -->
                        <a-obj-model src="#marble-table-obj" mtl="#marble-table-mtl" scale=".015 .015 .015" position="0 -1 0"></a-obj-model>
                        <a-animation begin="hitboxIn" attribute="material.opacity" from="0" to="0.4" dur="1000"></a-animation>
                        <a-animation begin="hitboxOut" attribute="material.opacity" from="0.4" to="0" dur="1000"></a-animation>
                    </a-box>

                    <!-- Cloisons amovibles -->
                    <a-box static-body color="white" depth=".01" width="4.5" height="2" position="0 1 0">
                        <a-sphere radius=".1" color="white" position="-2.25 -1 0"></a-sphere>
                        <a-sphere radius=".1" color="white" position="2.25 -1 0"></a-sphere>
                    </a-box>
                    <a-box static-body color="white" depth=".01"  width="4.5" height="2" position="7.5 1 0">
                        <a-sphere radius=".1" color="white" position="-2.25 -1 0"></a-sphere>
                        <a-sphere radius=".1" color="white" position="2.25 -1 0"></a-sphere>
                    </a-box>
                    <a-box static-body color="white" depth=".01"  width="3" height="2" position="-7.5 1 0" rotation="0 90 0">
                        <a-sphere radius=".1" color="white" position="-1.5 -1 0"></a-sphere>
                        <a-sphere radius=".1" color="white" position="1.5 -1 0"></a-sphere>
                    </a-box>

                    <!-- Reliques -->
                    <a-obj-model src="#upper-cabinet-obj" mtl="#upper-cabinet-mtl" scale=".4 .4 .4" position="1.5 2.75 -1"></a-obj-model>
                    <a-obj-model src="#upper-cabinet-obj" mtl="#upper-cabinet-mtl" scale=".4 .4 .4" position="4.5 2.75 1" rotation="0 180 0"></a-obj-model>
                    <a-obj-model src="#upper-cabinet-obj" mtl="#upper-cabinet-mtl" scale=".4 .4 .4" position="8.5 2.75 1" rotation="0 180 0"></a-obj-model>

                    <!-- NPC -->
                    <a-obj-model id="penguin" src="#penguin-obj" mtl="#penguin-mtl" rotation="-90 0 0" position="0 0 2.5">
                        <a-animation begin="3000" attribute="position" to="11 0 2.5" dur="10000"></a-animation>

                        <a-animation begin="npcRot1" attribute="rotation" to="-90 90 0" dur="2000"></a-animation>
                        <a-animation begin="npcPos1" attribute="position" to="11 0 -10" dur="10000"></a-animation>

                        <a-animation begin="npcRot2" attribute="rotation" to="-90 180 0" dur="2000"></a-animation>
                        <a-animation begin="npcPos2" attribute="position" to="4 0 -10" dur="10000"></a-animation>

                        <a-animation begin="npcRot3" attribute="rotation" to="-90 270 0" dur="2000"></a-animation>
                        <a-animation begin="npcPos3" attribute="position" to="4 0 -2.5" dur="10000"></a-animation>

                        <a-animation begin="npcRot4" attribute="rotation" to="-90 180 8" dur="2000"></a-animation>
                        <a-animation begin="npcPos4" attribute="position" to="-11 0 -2.5" dur="15000"></a-animation>

                        <a-animation begin="npcRot5" attribute="rotation" to="-90 270 8" dur="2000"></a-animation>
                        <a-animation begin="npcPos5" attribute="position" to="-11 0 2.5" dur="10000"></a-animation>

                        <a-animation begin="npcRot6" attribute="rotation" to="-90 0 8" dur="7000"></a-animation>
                        <a-animation begin="npcPos6" attribute="position" to="11 0 2.5" dur="15000"></a-animation>
                    </a-obj-model>

                    <!-- 4 pieces du fond (gauche-droite) -->
                    <a-entity position="-11.25 0 -10"><!-- Piece 1 (lecture) -->
                        <a-sphere class="lightRoom" id="lRoom1" radius=".2" shader="flat" color="grey" position="0 3 0"></a-sphere> <!--Lampe -->

                        <a-obj-model src="#bibliotheque-obj" color="#740" scale=".6 .8 .4" position="-2 1.5 -4.7"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="-1 0 -4.7"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="-1 1.4 -4.7"></a-obj-model>
                        <a-obj-model src="#bibliotheque-obj" color="#740" scale=".6 .8 .4" position="1 1.5 -4.7"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="2 0 -4.7"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="2 1.4 -4.7"></a-obj-model>

                        <a-obj-model src="#bibliotheque-obj" color="#740" scale=".6 .8 .4" position="-3 1.5 -2" rotation="0 90 0"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="-3 0 0" rotation="0 90 0"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="-3 1.4 0" rotation="0 90 0"></a-obj-model>
                        <a-obj-model src="#bibliotheque-obj" color="#740" scale=".6 .8 .4" position="-3 1.5 2" rotation="0 90 0"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="-3 0 4" rotation="0 90 0"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="-3 1.4 4" rotation="0 90 0"></a-obj-model>

                        <a-obj-model src="#bibliotheque-obj" color="#740" scale=".6 .8 .4" position="3.4 1.5 -2" rotation="0 -90 0"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="3.4 0 0" rotation="0 -90 0"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="3.4 1.4 0" rotation="0 -90 0"></a-obj-model>
                        <a-obj-model src="#bibliotheque-obj" color="#740" scale=".6 .8 .4" position="3.4 1.5 2" rotation="0 -90 0"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="3.4 0 3" rotation="0 -90 0"></a-obj-model>
                        <a-obj-model src="#smallbookshelves-obj" mtl="#smallbookshelves-mtl" scale=".45 .45 .45" position="3.4 1.4 3" rotation="0 -90 0"></a-obj-model>
                    </a-entity>

                    <a-entity position="-3.75 0 -10"><!-- Piece 2 (projection) -->
                        <a-sphere class="lightRoom" id="lRoom2" radius=".2" shader="flat" color="grey" position="0 3 0"></a-sphere> <!--Lampe -->

                        <!-- Fait tout planter au refresh --><!-- <a-video src="#ys-movie"  width="4" height="2.25" position="0 1.5 -4.74"></a-video> -->
                        <a-obj-model src="#speaker-obj" mtl="#speaker-mtl" scale=".02 .02 .02" position="-3.75 1 -4" rotation="0 45 0"></a-obj-model>
                        <a-obj-model src="#speaker-obj" mtl="#speaker-mtl" scale=".02 .02 .02" position="3 1 -5" rotation="0 -45 0"></a-obj-model>

                        <a-obj-model src="#sofa-obj" mtl="#sofa-mtl" scale=".01 .01 .01" position="-.5 0 -1" rotation="0 180 0"></a-obj-model>
                        <a-obj-model src="#sofa-obj" mtl="#sofa-mtl" scale=".01 .01 .01" position="-.5 0 1" rotation="0 180 0"></a-obj-model>
                        <a-obj-model src="#sofa-obj" mtl="#sofa-mtl" scale=".01 .01 .01" position="-.5 0 3" rotation="0 180 0"></a-obj-model>

                        <a-obj-model src="#sofa-obj" mtl="#sofa-mtl" scale=".01 .01 .01" position="3.5 0 -1" rotation="0 180 0"></a-obj-model>
                        <a-obj-model src="#sofa-obj" mtl="#sofa-mtl" scale=".01 .01 .01" position="3.5 0 1" rotation="0 180 0"></a-obj-model>
                        <a-obj-model src="#sofa-obj" mtl="#sofa-mtl" scale=".01 .01 .01" position="3.5 0 3" rotation="0 180 0"></a-obj-model>
                    </a-entity>

                    <a-entity position="3.75 0 -10"><!-- Piece 3 (tableaux) -->
                        <a-sphere class="lightRoom" id="lRoom3" radius=".2" shader="flat" color="grey" position="0 3 0"></a-sphere> <!--Lampe -->

                        <a-obj-model src="#t1-obj" mtl="#t1-mtl" scale=".04 .04 .04" position="0 .5 -4.70" rotation="0 0 -90"></a-obj-model>

                        <a-obj-model src="#t4-obj" mtl="#t4-mtl" scale=".015 .015 .015" position="-3.5 -1.7 -1.7" rotation="0 90 0"></a-obj-model>
                        <a-obj-model src="#t6-obj" mtl="#t6-mtl" scale=".03 .03 .03" position="-3.5 1.5 2" rotation="0 90 0"></a-obj-model>

                        <a-obj-model src="#t7-obj" mtl="#t7-mtl" scale=".03 .03 .03" position="3.5 1.5 -3" rotation="0 -90 0"></a-obj-model>
                        <a-obj-model src="#t8-obj" mtl="#t8-mtl" scale=".015 .015 .015" position="3.5 .75 2.75" rotation="0 -90 0"></a-obj-model>
                    </a-entity>

                    <a-entity position="11.25 0 -10"><!-- Piece 4 (tableaux) -->
                        <a-sphere class="lightRoom" id="lRoom4" radius=".2" shader="flat" color="grey" position="0 3 0"></a-sphere> <!--Lampe -->

                        <a-obj-model src="#t3-obj" mtl="#t3-mtl" scale=".015 .015 .015" position="0 .45 -4.70"></a-obj-model>

                        <a-obj-model src="#t2-obj" mtl="#t2-mtl" scale=".03 .03 .03" position="-3.5 1.5 -3" rotation="0 90 0"></a-obj-model>
                        <a-obj-model src="#t9-obj" mtl="#t9-mtl" scale=".03 .03 .03" position="-3.5 1.5 3" rotation="0 90 0"></a-obj-model>

                        <a-obj-model src="#t5-obj" mtl="#t5-mtl" scale=".05 .05 .05" position="3.3 1.5 0" rotation="0 -90 0"></a-obj-model>
                    </a-entity>

                </a-entity>
                <!-- Mobilier & objets / FIN -->
            </a-entity>
        </a-scene>

        <script>
            (function() {
                var lRooms = document.querySelectorAll('.lightRoom');
                var player = document.querySelector('a-camera');
                var cursor = player.querySelector('a-cursor');
                var fwdAnim = player.querySelector('#fwdAnim');

                // Détection pièce
                player.addEventListener('collide', function(evt) {
                    var el = evt.detail.body.el;
                    if (el.hasAttribute('coll-trigger')) {
                        //console.log('Player is in room ' + el.id);

                        // Éclairage
                        for (var i = 0; i < lRooms.length; i++) {
                            var lamp = lRooms[i];
                            if (lamp.id == 'l'+el.id) {
                                lamp.setAttribute('color', 'lightblue');
                                lamp.setAttribute('light', 'type: point; intensity: .25; color: lightblue;');
                            } else {
                                lamp.setAttribute('color', 'grey');
                                lamp.removeAttribute('light');
                            }
                        }
                    }
                });

                // Animations gaze (amer)
                var hovEls = document.querySelectorAll('[gaze-anim]');
                for (var i = 0; i < hovEls.length; i++) {
                    hovEls[i].addEventListener('click', function(evt) {
                        var _from = player.getAttribute('position');
                        var to = this.getAttribute('position');

                        // Pour arriver à distance de l'amer
                        var dx = _from.x - to.x;
                        var dz = _from.z - to.z

                        fwdAnim.setAttribute('from', _from.x+' '+_from.y+' '+_from.z);
                        fwdAnim.setAttribute('to', (to.x + Math.sign(dx))+' '+_from.y+' '+(to.z + Math.sign(dz)));

                        player.emit('fwdEvt');
                    });
                    hovEls[i].addEventListener('stateadded', function(evt) {
                        if (evt.detail.state == 'hovered') {
                            this.emit('hitboxIn');
                            cursor.emit('cursorEvt');
                        }
                    });
                    hovEls[i].addEventListener('stateremoved', function(evt) {
                        if (evt.detail.state == 'hovered') {
                            this.emit('hitboxOut');
                        }
                    });
                }

                // Animation pingouin
                var penguin = document.querySelector('#penguin');
                penguin.addEventListener('animationend', function(evt) {
                    var evtName = evt.target.getAttribute('begin');
                    switch (evtName) {
                        case '3000' :
                        case 'npcPos6' :
                            penguin.emit('npcRot1');
                        break;
                        case 'npcRot1' :
                            penguin.emit('npcPos1');
                        break;
                        case 'npcPos1' :
                            penguin.emit('npcRot2');
                        break;
                        case 'npcRot2' :
                            penguin.emit('npcPos2');
                        break;
                        case 'npcPos2' :
                            penguin.emit('npcRot3');
                        break;
                        case 'npcRot3' :
                            penguin.emit('npcPos3');
                        break;
                        case 'npcPos3' :
                            penguin.emit('npcRot4');
                        break;
                        case 'npcRot4' :
                            penguin.emit('npcPos4');
                        break;
                        case 'npcPos4' :
                            penguin.emit('npcRot5');
                        break;
                        case 'npcRot5' :
                            penguin.emit('npcPos5');
                        break;
                        case 'npcPos5' :
                            penguin.emit('npcRot6');
                        break;
                        case 'npcRot6' :
                            penguin.emit('npcPos6');
                        break;
                    }
                });
            })();
        </script>
    </body>
</html>
