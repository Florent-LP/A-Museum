<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>Ys Museum</title>

        <script src="dist/stable/aframe.min.js"></script><!-- Version stable -->
        <script src="dist/extras/aframe-extras.min.js"></script><!-- A-frame stable seulement -->

        <!--<script src="dist/rolling/aframe.min.js"></script>--><!-- Version récente -->
        <!--<script src="scripts/raycaster-helper.js"></script>--><!-- A-frame rolling seulement -->
    </head>
    <body>
        <a-scene physics stats>
            <a-assets>
                <!-- Textures prod (lent) -->
                <img id="skybox" src="assets/images/sky-r2.jpg">
                <img id="terrasse" src="assets/images/textures/terrasse-corrected.jpg">
                <img id="parquet" src="assets/images/textures/parquet.jpg">
                <img id="mur" src="assets/images/textures/mur2-corrected.jpg">
                <img id="vitre" src="assets/images/textures/verre.png">
                <img id="pillier" src="assets/images/textures/pillier.jpg">
                <a-mixin id="pillier" material="src: #pillier; repeat: 2 3;">

                <!-- Textures dev (rapide) -->
                <!-- <img id="skybox" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOs////PwAIAAN+P+P0CgAAAABJRU5ErkJggg=="> -->
                <!-- <img id="terrasse" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPcksLwHwAFBQIZtcb7ngAAAABJRU5ErkJggg=="> -->
                <!-- <img id="parquet" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8cILhPwAHIQK5QliE3QAAAABJRU5ErkJggg=="> -->
                <!-- <img id="mur" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mM88x8AAp0BzdNtlUkAAAAASUVORK5CYII="> -->
                <!-- <img id="vitre" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOs////PwAIAAN+P+P0CgAAAABJRU5ErkJggg=="> -->
                <!-- <img id="pillier" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mPcksLwHwAFBQIZtcb7ngAAAABJRU5ErkJggg=="> -->
                <!-- <a-mixin id="pillier" material="color: orange;"> -->

                <!-- Modèles -->
                <a-asset-item id="stairs-obj" src="assets/models/stairs/stairs.obj">
                <a-asset-item id="ladder-obj" src="assets/models/stairs/ladder.obj">
                <a-asset-item id="ladder-mtl" src="assets/models/stairs/ladder.mtl">

                <!-- Etc -->
                <!-- <video id="ys-movie" autoplay loop="true" src="videos/ys-movie-short.webm"> -->
            </a-assets>


            <a-sky src="#skybox"></a-sky>


            <!-- Soleil (avec shpere) -->
            <!--<a-sphere
                radius="50"
                shader="flat" color="orange" light="type: point"
                position="1050 1000 60"
            ></a-sphere>-->

            <!-- Soleil (sans sphère) -->
            <a-light
                color="white"
                type="directional"
                position="1.05 1 .6"
                intensity=".5"
            ></a-light>

            <!-- Lumière solaire reflétée (Bug : intensity -> Solution : color)-->
            <a-light
                color="#666"
                type="ambient"
            ></a-light>


            <a-entity position="0 -3.25 -60"> <!-- Note : J'enlève 0.002 aux largeurs pour éviter le scintillement lié à la superposition de certains plans. -->
                <a-camera kinematic-body universal-controls="movementEnabled: true" jump-ability="enableDoubleJump: true; distance: 5" position="0 5.14 10">
                        <!-- Détection pièce (A-frame stable seulement) -->
                        <!-- <a-entity raycaster="objects: .collidable; far: 4; interval: 1000" rotation="-90 0 0" raycaster-helper material="color: red"></a-entity>-->
                        <a-sphere radius=".2" shader="flat" color="lightblue" light="type: point; intensity: .25; color: lightblue;" position="0.8 -0.5 -1.5"></a-sphere>
                        <a-cursor fuse="true" maxDistance="100" timeout="200"></a-cursor>
                        <a-animation id="fwdAnim" attribute="position" begin="fwdEvt" to="0 5 0" easing="linear" dur="2500"></a-animation>
                </a-camera>


                <!-- Mer -->
                <!-- <a-plane static-body color="#0088FF" width="1000" height="1000" rotation="-90 0 0" position="0 -2.5 0"></a-plane> -->
                <a-ocean static-body color="#92E2E2" width="500" depth="500" density="150" speed="2"></a-ocean>
                <a-plane static-body color="#7FFFFF" width="800" height="800" rotation="-90 0 0" position="0 -3 0"></a-plane>


                <!-- Plateforme / DÉBUT -->
                <!-- Piliers -->
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="14 0 14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="4.75 0 14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="14 0 4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="4.75 0 4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-14 0 14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-4.75 0 14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-14 0 4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-4.75 0 4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="14 0 -14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="4.75 0 -14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="14 0 -4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="4.75 0 -4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-14 0 -14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-4.75 0 -14"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-14 0 -4.75"></a-cylinder>
                <a-cylinder static-body mixin="pillier" height="6" radius=".3" position="-4.75 0 -4.75"></a-cylinder>

                <!-- Sol -->
                <a-box static-body src="#terrasse" repeat="10 10" depth=".5" width="30" height="30" rotation="-90 0 0" position="0 3 0"></a-box>
                <a-plane static-body coll-notif src="#parquet" repeat="6 4" width="30" height="20" rotation="-90 0 0" position="0 3.251 -5"></a-plane>

                <!-- Échelles -->
                <a-box static-body src="#pillier" repeat="14 1" depth=".8" width="28" height="1" position="0 0 14.7"></a-box>

                <a-obj-model src="#ladder-obj" position="9 0 15" scale=".02 .02 .02"></a-obj-model>
                <a-obj-model src="#ladder-obj" position="0 0 15" scale=".02 .02 .02"></a-obj-model>
                <a-obj-model src="#ladder-obj" position="-9 0 15" scale=".02 .02 .02"></a-obj-model>
                <!-- Plateforme / FIN -->


                <!-- Murs principaux / DÉBUT -->
                <!-- Nord -->
                <a-box static-body src="#mur" repeat="15 3" depth=".25" width="29.998" height="6" position="0 6.25 -14.875"></a-box>

                <!-- Est -->
                <a-box static-body src="#mur" repeat="6.25 1.5" depth=".25" width="12.498" height="3" position="14.875 4.75 -8.75" rotation="0 -90 0"></a-box>
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="14.875 4.75 3.75" rotation="0 -90 0"></a-box>
                <a-box class="hoverAnim" static-body src="#vitre" repeat="5 3" opacity="0.5" color="lightblue" depth=".05" width="5" height="3"  position="14.875 4.75 0" rotation="0 -90 0"></a-box>

                <a-box static-body src="#mur" repeat="10 1.5" depth=".25" width="19.998" height="3" position="14.875 7.75 -5" rotation="0 -90 0"></a-box>

                <!-- Ouest -->
                <a-box static-body src="#mur" repeat="6.25 1.5" depth=".25" width="12.498" height="3" position="-14.875 4.75 -8.75" rotation="0 90 0"></a-box>
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="-14.875 4.75 3.75" rotation="0 90 0"></a-box>
                <a-box class="hoverAnim" static-body src="#vitre" repeat="5 3" opacity="0.5" color="lightblue" depth=".05" width="5" height="3"  position="-14.875 4.75 0" rotation="0 90 0"></a-box>

                <a-box static-body src="#mur" repeat="10 1.5" depth=".25" width="19.998" height="3" position="-14.875 7.75 -5" rotation="0 90 0"></a-box>

                <!-- Sud (Terrasse) -->
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="-3.25 4.75 4.875"></a-box>
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="-13.75 4.75 4.875"></a-box>
                <a-box class="hoverAnim" static-body src="#vitre" repeat="8 3" opacity="0.5" color="lightblue" depth=".05" width="8" height="3" position="-8.5 4.75 4.875"></a-box>

                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="3.25 4.75 4.875"></a-box>
                <a-box static-body src="#mur" repeat="1.25 1.5" depth=".25" width="2.498" height="3" position="13.75 4.75 4.875"></a-box>
                <a-box class="hoverAnim" static-body src="#vitre" repeat="8 3" opacity="0.5" color="lightblue" depth=".05" width="8" height="3" position="8.5 4.75 4.875"></a-box>

                <a-box static-body src="#mur" repeat="15 1.5" depth=".25" width="29.998" height="3" position="0 7.75 4.875"></a-box>

                <!-- Entrée -->
                <a-box src="#vitre" repeat="4 3" opacity="0.5" color="lightblue" depth=".05" width="4" height="3" position="0 4.75 4.875"></a-box>

                <!-- Plafond -->
                <a-box static-body src="#mur" repeat="15 12.5" depth=".25" width="29.998" height="25" position="0 9.375 -2.5" rotation="90 0 0"></a-box>
                <!-- Murs principaux / FIN -->


                <!-- Murs intérieurs / DÉBUT -->
                <!-- Mezzanine -->
                <a-box static-body src="#mur" repeat="15 5" depth=".25" width="29.998" height="9.998" position="0 6.375 -10" rotation="90 0 0"></a-box>

                <!-- Cloisons fixes -->
                <a-box static-body src="#mur" repeat="5 1.5" depth=".25" width="9.998" height="3" position="0 4.75 -10" rotation="0 90 0"></a-box>
                <a-box static-body src="#mur" repeat="2 1.5" depth=".25" width="3.998" height="3" position="7.5 4.75 -7" rotation="0 90 0"></a-box><a-box src="#mur" repeat="2 1.5" depth=".25" width="3.998" height="3" position="7.5 4.75 -13" rotation="0 90 0"></a-box>
                <a-box static-body src="#mur" repeat="5 1.5" depth=".25" width="9.998" height="3" position="-7.5 4.75 -10" rotation="0 90 0"></a-box>

                <a-box static-body src="#mur" repeat="2.25 1.5" depth=".25" width="4.48" height="3" position="0 4.75 -5.125"></a-box>
                <a-box static-body src="#mur" repeat="2.25 1.5" depth=".25" width="4.48" height="3" position="7.5 4.75 -5.125"></a-box>
                <a-box static-body src="#mur" repeat="2.25 1.5" depth=".25" width="4.48" height="3" position="-7.5 4.75 -5.125"></a-box>
                <a-box static-body src="#mur" repeat="1.125 1.5" depth=".25" width="2.248" height="3" position="13.875 4.75 -5.125"></a-box>
                <a-box static-body src="#mur" repeat="1.125 1.5" depth=".25" width="2.248" height="3" position="-13.875 4.75 -5.125"></a-box>
                <!-- Murs intérieurs / FIN -->


                <!-- Repère -->
                <a-entity position="0 3.25 10">
                    <a-sphere color="grey" radius=".2" ></a-sphere>
                    <!-- X --><a-cylinder height="2" color="red"   radius=".05" position="1 0 0" rotation="0 0 -90"></a-cylinder>
                    <!-- Y --><a-cylinder height="2" color="green"  radius=".05" position="0 1 0"></a-cylinder>
                    <!-- Z --><a-cylinder height="2" color="blue" radius=".05" position="0 0 1" rotation="90 0 0"></a-cylinder>
                </a-entity>

                <!-- Lampe -->
                <a-sphere class="hoverAnim" dynamic-body radius=".4" shader="flat" color="lightblue" light="type: point; intensity: .25; color: lightblue;" position="0 6 0"></a-sphere>

                <!-- Mobilier & objets -->
                <a-entity position="0 3.25 0"><!-- Hall -->

                    <!-- Escaliers -->
                    <a-obj-model src="#stairs-obj" color="lightgrey" metalness="1" position="7.5 1.6 -1.3" scale=".7 .7 .7"></a-obj-model>
                    <a-obj-model src="#stairs-obj" color="lightgrey" metalness="1" position="-7.5 1.6 -1.3" scale=".7 .7 .7"></a-obj-model>

                    <!-- Cloisons amovibles -->
                    <a-box static-body color="white" depth=".01" width="4.5" height="2" position="0 1 0">
                        <a-sphere radius=".1" color="white" position="-2.25 -1 0"></a-sphere>
                        <a-sphere radius=".1" color="white" position="2.25 -1 0"></a-sphere>
                    </a-box>
                    <a-box static-body color="white" depth=".01"  width="4.5" height="2" position="7.5 1 2">
                        <a-sphere radius=".1" color="white" position="-2.25 -1 0"></a-sphere>
                        <a-sphere radius=".1" color="white" position="2.25 -1 0"></a-sphere>
                    </a-box>
                    <a-box static-body color="white" depth=".01"  width="3" height="2" position="-7.5 1 2" rotation="0 90 0">
                        <a-sphere radius=".1" color="white" position="-1.5 -1 0"></a-sphere>
                        <a-sphere radius=".1" color="white" position="1.5 -1 0"></a-sphere>
                    </a-box>

                    <!-- 4 pieces du fond (gauche-droite) -->
                    <a-entity position="-11.25 0 -10"><!-- Piece 1 (lecture) -->

                    </a-entity>

                    <a-entity position="-3.75 0 -10"><!-- Piece 2 (projection) -->
                        <!-- Fait tout planter --><!-- <a-video src="#ys-movie"  width="4" height="2.25" position="0 1.5 -4.74"></a-video> -->
                    </a-entity>

                    <a-entity position="3.75 0 -10"><!-- Piece 3 (tableaux) -->

                    </a-entity>

                    <a-entity position="11.25 0 -10"><!-- Piece 4 (tableaux) -->

                    </a-entity>

                </a-entity>
            </a-entity>
        </a-scene>

        <script>
            (function() {
                // Détection pièce

                // A-Frame rolling uniquement
                // document.addEventListener('raycaster-intersected', function(e) {
                //     console.log('Collision !');
                // });

                // A-Frame extras uniquement
                var player = document.querySelector('a-camera');
                player.addEventListener('collide', function (evt) {
                    var el = evt.detail.body.el;
                    if (el.hasAttribute('coll-notif')) {
                        console.log('Player is in room ' + el.id);
                    }
                });

                var hovEls = document.querySelectorAll('.hoverAnim');
                for (var i = 0; i < hovEls.length; i++) {
                    hovEls[i].addEventListener('stateadded', function(evt) {
                        var state = evt.detail.state;
                        var el = evt.detail.target;

                        if (state == 'hovered') {
                            var from = player.getAttribute('position');
                            var to = el.getAttribute('position');
                            for (var key in to)
                                to[key] = Math.round(to[key]*10)/10;

                            var dx = from.x - to.x;
                            var dz = from.z - to.z

                            var anim = player.querySelector('#fwdAnim');
                            anim.setAttribute('from', from.x+' '+from.y+' '+from.z);
                            anim.setAttribute('to', (to.x + Math.sign(dx))+' '+from.y+' '+(to.z + Math.sign(dz)));
                            console.log(anim);

                            //player.setAttribute('position', pos.x+' '+from.y+' '+pos.z);
                            //el.removeState('stateadded');
                            player.emit('fwdEvt');
                        }
                    });
                }
            })();
        </script>
    </body>
</html>
